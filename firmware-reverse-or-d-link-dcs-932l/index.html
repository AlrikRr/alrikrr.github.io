<!DOCTYPE html><html lang="en-ca"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Firmware Reverse | D-Link - DCS-932L - AlrikRr&#x27;s Blog</title><meta name="description" content="This is actually my first firmware ‚ÄúReverse‚Äù. This post will also serve as a tutorial for myself and others !&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="gdpr-blocker/Google Analytics">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','G-22SHFE01F3');</script><link rel="stylesheet" href="https://alrikrr.github.io/media/plugins/syntaxHighlighter/prism-black.css"><link rel="canonical" href="https://alrikrr.github.io/firmware-reverse-or-d-link-dcs-932l/"><link rel="alternate" type="application/atom+xml" href="https://alrikrr.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://alrikrr.github.io/feed.json"><meta property="og:title" content="Firmware Reverse | D-Link - DCS-932L"><meta property="og:image" content="https://alrikrr.github.io/media/posts/12/firmware.jpg"><meta property="og:image:width" content="1920"><meta property="og:image:height" content="1095"><meta property="og:site_name" content="AlrikRr's Blog"><meta property="og:description" content="This is actually my first firmware ‚ÄúReverse‚Äù. This post will also serve as a tutorial for myself and others !&hellip;"><meta property="og:url" content="https://alrikrr.github.io/firmware-reverse-or-d-link-dcs-932l/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@alrikrr"><meta name="twitter:title" content="Firmware Reverse | D-Link - DCS-932L"><meta name="twitter:description" content="This is actually my first firmware ‚ÄúReverse‚Äù. This post will also serve as a tutorial for myself and others !&hellip;"><meta name="twitter:image" content="https://alrikrr.github.io/media/posts/12/firmware.jpg"><link rel="shortcut icon" href="https://alrikrr.github.io/media/website/android-chrome-192x192.png" type="image/x-icon"><link rel="stylesheet" href="https://alrikrr.github.io/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://alrikrr.github.io/assets/css/style.css?v=9c9d2fbfcab8b79b8c58630080d7437a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://alrikrr.github.io/firmware-reverse-or-d-link-dcs-932l/"},"headline":"Firmware Reverse | D-Link - DCS-932L","datePublished":"2022-09-22T20:46","dateModified":"2023-08-15T20:46","image":{"@type":"ImageObject","url":"https://alrikrr.github.io/media/posts/12/firmware.jpg","height":1095,"width":1920},"description":"This is actually my first firmware ‚ÄúReverse‚Äù. This post will also serve as a tutorial for myself and others !&hellip;","author":{"@type":"Person","name":"AlrikRr","url":"https://alrikrr.github.io/authors/alrikrr/"},"publisher":{"@type":"Organization","name":"AlrikRr"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://alrikrr.github.io/"><strong>AlrikRr&#x27;s Blog</strong></a><ul class="icons"><li><a href="https://twitter.com/AlrikRr" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li><li><a href="https://www.linkedin.com/in/adrien-lasalle/" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li><li><a href="https://www.youtube.com/channel/UCHUrf2NqybwOFQ6tfYt3zNA" class="icon brands fa-youtube"><span class="label">YouTube</span></a></li></ul></header><article class="post"><header class="main post__header"><time datetime="2022-09-22T20:46" class="post__date">22 September 2022</time><h1>Firmware Reverse | D-Link - DCS-932L</h1></header><figure class="image main"><img src="https://alrikrr.github.io/media/posts/12/firmware.jpg" srcset="https://alrikrr.github.io/media/posts/12/responsive/firmware-xs.jpg 300w, https://alrikrr.github.io/media/posts/12/responsive/firmware-sm.jpg 480w, https://alrikrr.github.io/media/posts/12/responsive/firmware-md.jpg 768w, https://alrikrr.github.io/media/posts/12/responsive/firmware-lg.jpg 1024w, https://alrikrr.github.io/media/posts/12/responsive/firmware-xl.jpg 1360w, https://alrikrr.github.io/media/posts/12/responsive/firmware-xxl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="lazy" height="1095" width="1920" alt=""></figure><div class="post__inner post__entry"><p class="alert alert-warning msg msg--warning"><strong>This is actually my first firmware ‚ÄúReverse‚Äù. This post will also serve as a tutorial for myself and others !</strong></p><p class="alert alert-danger msg msg--warning"><strong>For education purpose</strong></p><hr><h1 id="sources">Sources</h1><ul><li>Version :¬†<code>1.14.04</code></li><li>MD5 :¬†<code>b93d60f595c4736a153ca8c61d77ffc6</code></li><li>Download link¬†<a href="http://files.dlink.com.au/products/DCS-932L/REV_A/Firmware/">http://files.dlink.com.au/products/DCS-932L/REV_A/Firmware/</a></li></ul><p>This test we perfomed on Kali Linux VM.</p><h1 id="stage-1---analysis">Stage 1 - Analysis</h1><p>Using¬†<code>binwalk</code>¬†we can ‚Äúwalk‚Äù through the firmware and check signatures inside the binary, those signatures return known Desciption and Hex address. of what‚Äôs inside the binary.</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">binwalk dcs932l_v1.14.04.bin
</code></pre></div><p>Here is the output</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
106352        0x19F70         U-Boot version string, "U-Boot 1.1.3"
106816        0x1A140         CRC32 polynomial table, little endian
124544        0x1E680         HTML document header
124890        0x1E7DA         HTML document footer
124900        0x1E7E4         HTML document header
125092        0x1E8A4         HTML document footer
125260        0x1E94C         HTML document header
125953        0x1EC01         HTML document footer
327680        0x50000         uImage header, header size: 64 bytes, header CRC: 0x88345E96, created: 2016-09-09 13:52:27, image size: 3804958 bytes, Data Address: 0x80000000, Entry Point: 0x803B8000, data CRC: 0x531E94DE, OS: Linux, CPU: MIPS, image type: OS Kernel Image, compression type: lzma, image name: "Linux Kernel Image"
327744        0x50040         LZMA compressed data, properties: 0x5D, dictionary size: 33554432 bytes, uncompressed size: 6558763 bytes
</code></pre></div><h2 id="binwalk-result">Binwalk Result</h2><ul><li><code>106352 - 0x19F70</code>¬†: U-Boot 1.1.3</li><li><code>327680 - 0x50000</code>¬†: Linux Kernel Image</li><li><code>327744 - 0x50040</code>¬†: LZMA Compress Data</li></ul><p>uImage Header at¬†<code>327680</code>¬†tell us that we can found a LInux Kerne Image in a LZMA arhcive format.</p><h2 id="decompress-lzma">Decompress LZMA</h2><p>Unpack the LZMA Archive using¬†<code>dd</code>¬†tool. We output the result inside the¬†<code>kernal.lzma</code>¬†file.</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">dd if=dcs932l_v1.14.04.bin skip=327744 bs=1 of=kernel.lzma
</code></pre></div><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/kernellzmq.jpeg" alt="kernel.lzma" data-is-external-image="true"></p><p>Make sure the LZMA file is well extracted</p><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/kernel-check.jpeg" alt="kernel.lzma.check" data-is-external-image="true"></p><p>Now let‚Äôs extract the LZMA achive using¬†<code>unlzma</code>¬†tool</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">unlzma -d &lt; kernel.lzma &gt; kernel
</code></pre></div><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/lzma-check.jpeg" alt="kernel.lzma.check" data-is-external-image="true"></p><div class="alert alert-warning"><strong>Got an error while extracting the kernel bit it seems working just fine for now , lucky me.</strong></div><h1 id="stage-2---kernel">Stage 2 - Kernel</h1><p>Now we have the kernel in our hands, let‚Äôs see what‚Äôs in there.</p><p>Again we use¬†<code>binwalk</code></p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
3145804       0x30004C        Linux kernel version 2.6.21
3175792       0x307570        SHA256 hash constants, little endian
3183312       0x3092D0        AES Inverse S-Box
3184080       0x3095D0        AES S-Box
3389960       0x33BA08        Unix path: /usr/gnemul/irix/
3392244       0x33C2F4        Unix path: /usr/lib/libc.so.1
3393940       0x33C994        Unix path: /dev/vc/0
3408260       0x340184        Copyright string: "Copyright (c) 2010 Alpha Networks Inc."
3491536       0x3546D0        Unix path: /etc/Wireless/RT2860STA/RT2860STA.dat
3573187       0x3685C3        Neighborly text, "neighbor %.2x%.2x.%.2x:%.2x:%.2x:%.2x:%.2x:%.2x lost on port %d(%s)(%s)"
3807776       0x3A1A20        CRC32 polynomial table, little endian
3811440       0x3A2870        AES S-Box
4038656       0x3DA000        LZMA compressed data, properties: 0x5D, dictionary size: 1048576 bytes, uncompressed size: 8072704 bytes
</code></pre></div><p>Another LZMA archive is visible at 4038656</p><h2 id="extract-unkown-lzma-archive">Extract Unkown LZMA archive</h2><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/unkown.jpeg" alt="kernel.lzma.check" data-is-external-image="true"></p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">unlzma -d &lt; unknown.lzma &gt; unkown
</code></pre></div><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/unknown1.jpeg" alt="kernel.lzma.check" data-is-external-image="true"></p><p>And here we go, Here is the¬†<code>CPIO</code>¬†archive thta contain the file system of the firnware.</p><h2 id="cves">CVEs</h2><p>In the same time, the first¬†<code>binwalk</code>¬†on the kernel file give us the CVE output of the current kernel version¬†<strong><code>Linux Kernel 2.6.21 - 15 CVE</code></strong></p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">1	CVE-2012-1583	399		DoS	2012-06-16	2016-08-23	5.0	None	Remote	Low	Not
2	CVE-2009-2406	119		DoS
3	CVE-2009-1389	119		DoS
4	CVE-2009-0778			DoS	2009-03-12	2020-08-28	7.1	None	Remote	Medium	Not
5	CVE-2008-4609	16		DoS	2008-10-20	2021-07-07	7.1	None	Remote	Medium	Not
6	CVE-2008-2750	20		DoS
7	CVE-2008-1669	94		Exec
8	CVE-2008-1294	20		Bypass	2008-05-02	2018-10-30	2.1	None	Local	Low	Not
9	CVE-2008-0600	94		+Priv	2008-02-12	2018-10-30	7.2	None	Local	Low	Not
10	CVE-2008-0352	119		DoS
11	CVE-2007-2876			DoS	2007-06-11	2018-10-30	6.1	None	Local
12	CVE-2007-2453				2007-06-11	2018-10-30	1.2	None	Local	High	Not
13	CVE-2007-2451			+Info	2007-05-29	2018-10-30	5.0	None	Remote	Low	Not
14	CVE-2007-2172	20			2007-04-22	2018-10-19	4.7	None	Local	Medium	Not
15	CVE-2006-6058	189		DoS
</code></pre></div><h1 id="stage-3---unpack-cpio">Stage 3 - Unpack CPIO</h1><p>Now let‚Äôs unpack this arhive CPIO and see if we an get the file system.</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">sudo cpio -idm --no-absolute-filenames &lt; ../unkown
</code></pre></div><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/cpiounpack.jpeg" alt="kernel.lzma.check" data-is-external-image="true"></p><p>The filesystem is here we can now explore it on our own</p><h1 id="stage-4---filesystem">Stage 4 - Filesystem</h1><h2 id="etc_ro">/etc_ro/</h2><p>Inside the¬†<code>/etc_ro/</code>¬†folder we can see custom script and a web folder application.</p><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/etc_ro.jpeg" alt="kernel.lzma.check" data-is-external-image="true"></p><p>Simple Web application and private keys auto signed for the web server</p><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/etc_ro2.jpeg" alt="kernel.lzma.check" data-is-external-image="true"></p><p>Another firmware in the WLAN folder¬†<img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/etc_ro3.jpeg" alt="kernel.lzma.check" data-is-external-image="true"></p><p>And then the private RSA key fo the web server</p><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/etc_ro4.png" alt="kernel.lzma.check" data-is-external-image="true"></p><h2 id="sbin">/sbin/</h2><p>The sbin folder seems to be more interesting since we can check the custom scripts.¬†<img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/sbin1.jpeg" alt="sbin" data-is-external-image="true"></p><p>First thing I see while checking the custom scripts is that the absolute path of the binaries is not mentionned, this can be used as an exploit to bypass the real binary and use a malicious one if the¬†<code>$PATH</code>¬†variable is changed.</p><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/sbin2.jpeg" alt="sbin" data-is-external-image="true"></p><h2 id="internetsh">internet.sh</h2><p>This script is interesting, since we can see the process of creating a new user on the system which is added directly to the¬†<code>/ect/passwd</code>.</p><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/sbin3.jpeg" alt="sbin" data-is-external-image="true"></p><p>Here is some source code for the¬†<a href="https://github.com/Nossiac/mtk-openwrt-feeds/blob/master/applications/wificonf/files/usr/bin/nvram_get">nvram_get(click-me)</a>¬†function, from¬†<code>wificonf</code>¬†package.</p><p>This function seems to retreive a value from a device</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">nvram_get [dev] &lt;key&gt;
</code></pre></div><p>The value 2880 seems to be a default value for the first card</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell"><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-keyword">else</span>, try default mapping with l1profile:</span>
<span class="hljs-meta">#</span><span class="bash">     2880  -&gt; 1st card</span>
<span class="hljs-meta">#</span><span class="bash">     rtdev -&gt; 2nd card</span>
<span class="hljs-meta">#</span><span class="bash">     wifi3 -&gt; 3rd card</span>
</code></pre></div><h2 id="storagesh">storage.sh</h2><p>From this script we can see a nasty¬†<code>chmod 777</code>¬†on the home directory of the current user or the ser created.</p><p><img loading="lazy" src="https://alrikrr.github.io/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/storage.jpeg" alt="storage" data-is-external-image="true"></p><p>Here is the github that contains all the scripts files :¬†<a href="https://github.com/socoola/yhrouter/blob/master/user/rt2880_app/scripts/storage.sh">github-scripts</a></p></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on 15 August 2023</p><div class="post__share"><h3>Share post:</h3><a href="https://twitter.com/share?url=https%3A%2F%2Falrikrr.github.io%2Ffirmware-reverse-or-d-link-dcs-932l%2F&amp;via=%40AlrikRr&amp;text=Firmware%20Reverse%20%7C%20D-Link%20-%20DCS-932L" class="js-share icon brands fa-twitter" rel="nofollow noopener noreferrer"><span class="label">Twitter</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Falrikrr.github.io%2Ffirmware-reverse-or-d-link-dcs-932l%2F" class="js-share icon brands fa-linkedin" rel="nofollow noopener noreferrer"><span class="label">LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=Firmware%20Reverse%20%7C%20D-Link%20-%20DCS-932L https%3A%2F%2Falrikrr.github.io%2Ffirmware-reverse-or-d-link-dcs-932l%2F" class="js-share icon brands fa-whatsapp" rel="nofollow noopener noreferrer"><span class="label">WhatsApp</span></a></div><div class="post__tag"><ul><li><strong>Tagged in:</strong></li><li><a href="https://alrikrr.github.io/tags/iot-hacking/">IoT Hacking</a></li></ul></div><div class="post__bio"><img src="https://alrikrr.github.io/media/website/1675479739617.jpeg" loading="lazy" height="697" width="697" alt="AlrikRr"><div><h3><a href="https://alrikrr.github.io/authors/alrikrr/" class="invert" rel="author">AlrikRr</a></h3><p class="align-left">Formerly a firefighter in France üá´üá∑ üöí, I decided to pursue my passion for IT and especially offensive cybersecurity. Now a Pentester in Montreal üá®üá¶ for almost 3 years and an active member of HackersWithoutBorders North America, I am gradually specializing in internal and network intrusion testing.<br><br>Sharing our passion for this field, whether for awareness or education, is an important mission for me!<br><br>Feel free to contact me to discuss cyber or anything else over a beer :D üçª</p><ul><li class="align-left">My Github Account: <a href="https://github.com/AlrikRr" title="My Github" target="_blank" rel="noopener">AlrikRr</a></li><li class="align-left">My Twitter Account: <a href="https://twitter.com/AlrikRr" title="My Twitter" target="_blank" rel="noopener">AlrikRr</a></li><li class="align-left">Infosec.Exchange: <a href="https://infosec.exchange/@AlrikRr" title="My Mastodon Account" target="_blank" rel="noopener">@AlrikRr</a></li></ul></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><nav id="menu"><header class="major"><h2>Menu</h2></header><ul><li><a href="https://alrikrr.github.io/" target="_self">Home üè†</a></li><li><a href="https://alrikrr.github.io/authors/alrikrr/" target="_self">About me üë∫</a></li><li class="has-submenu"><a href="https://alrikrr.github.io/tags/" target="_self" aria-haspopup="true" class="opener">Categories üóÇÔ∏è</a><ul class="submenu level-2" aria-hidden="true"><li><a href="https://alrikrr.github.io/tags/" target="_self">All</a></li><li><a href="https://alrikrr.github.io/tags/updates/" target="_self">Personal Updates</a></li><li><a href="https://alrikrr.github.io/tags/flipperzero/" target="_self">FlipperZero</a></li><li><a href="https://alrikrr.github.io/tags/8-bits-computer/" target="_self">8 Bits Computer</a></li><li><a href="https://alrikrr.github.io/tags/iot-hacking/" target="_self">IoT Hacking</a></li><li><a href="https://alrikrr.github.io/tags/reverse-engineering/" target="_self">Reverse Engineering</a></li><li><a href="https://alrikrr.github.io/tags/malware/" target="_self">Malware</a></li><li><a href="https://alrikrr.github.io/tags/raspberrypi/" target="_self">RaspberryPi</a></li><li><a href="https://alrikrr.github.io/tags/pentesting/" target="_self">Pentesting</a></li><li><a href="https://alrikrr.github.io/tags/write-up/" target="_self">Write Up</a></li></ul></li><li class="has-submenu"><span aria-haspopup="true" class="opener">Projects üöß</span><ul class="submenu level-2" aria-hidden="true"><li><a href="https://github.com/AlrikRr/Cisco-Smart-Exploit" target="_blank">Cisco-Smart-Exploit</a></li><li><a href="https://github.com/AlrikRr/Forensic-Extract" target="_blank">Forensic-Extract</a></li><li><a href="https://github.com/AlrikRr/USBGuardian" target="_self">USBGuardian (fork)</a></li><li><a href="https://github.com/AlrikRr/DFIR-ExtracTux" target="_blank">DFIR-Extractux</a></li></ul></li><li><a href="https://www.buymeacoffee.com/AlrikRr" target="_blank">Buy me a beer üç∫</a></li></ul></nav><section><header class="major"><h2>Get in touch</h2></header><p>=== Area of expertise ===<br>üìç Web Application Pentest (OWASP)<br>üìç Internal Active Directory &amp; SCADA Pentest<br>üìç Pentest Cloud Azure<br>üìç Python &amp; PowerShell development<br>üìç Malware Analysis</p><ul class="contact"><li class="icon solid fa-envelope">adrienlasalle[dot]pro[at]gmail[dot]com</li><li class="icon solid fa-home">Montr√©al, Qc üá®üá¶</li></ul></section><footer id="footer"><p class="copyright">¬© AlrikRr 2023 - All rights reserved</p></footer></div></div></div><script src="https://alrikrr.github.io/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://alrikrr.github.io/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://alrikrr.github.io/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://alrikrr.github.io/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://alrikrr.github.io/assets/js/main.min.js?v=08add7f6d435054ad38ec38d7cf8be40"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script><script defer="defer" src="https://alrikrr.github.io/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://alrikrr.github.io/media/plugins/syntaxHighlighter/prism-line-numbers.min.js"></script><script defer="defer" src="https://alrikrr.github.io/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://alrikrr.github.io/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site for statistic purpose.</div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        initialLsState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('üç™ Config not found, or configuration expired');
            }

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                    'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                    'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                    'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                    'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                    'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                    'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                });  
                
                if (cbConfig.debugMode) {
                    console.log('üç™ GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                        'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                        'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                        'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                        'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                        'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                        'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                    }));
                }
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('üç™ Config founded');
            }

            cbConfig.initialLsState = currentConfig.split(',');

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                    'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                    'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                    'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                    'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                    'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                    'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                });
                
                if (cbConfig.debugMode) {
                    console.log('üç™ GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                        'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                        'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                        'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                        'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                        'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                        'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                    }));
                }
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function getDefaultConsentState (currentConfig, consentGroup) {
        let configGroups = currentConfig.split(',');

        for (let i = 0; i < configGroups.length; i++) {
            let groupName = configGroups[i];
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === groupName);

            if (group && group[consentGroup]) {
                return 'granted';
            }
        }  
        
        if (window.publiiCBGCM.defaultState[consentGroup]) {
            return 'granted'; 
        }
        
        return 'denied';
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('üç™ Allowed group: ' + allowedGroup);
        }

        if (window.publiiCBGCM && cbConfig.initialLsState.indexOf(allowedGroup) === -1) {
            let consentResult = {};
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === allowedGroup);

            if (group) {
                let foundSomeConsents = false;

                Object.keys(group).forEach(key => {
                    if (key !== 'cookieGroup' && group[key] === true) {
                        consentResult[key] = 'granted';
                        foundSomeConsents = true;
                    }
                });

                if (foundSomeConsents) {
                    gtag('consent', 'update', consentResult);   

                    if (cbConfig.debugMode) {
                        console.log('üç™ GCMv2 UPDATE: ' + JSON.stringify(consentResult));
                    }
                }
            }
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('üç™ Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('üç™ Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('üç™ State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('üç™ Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('üç™ Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('üç™ Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('üç™ Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('üç™ Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupToCheck !== '' && groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('üç™ Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('üç™ Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>